import discord
from discord.ext import tasks, commands
import requests

TOKEN = "SEU_TOKEN_AQUI"
CANAL_ID ="ID DO SEU CANAL"   # Ir no canal do discord, clicar com o botÃ£o direito e Copiar ID.

intents = discord.Intents.default() # permissÃµes bÃ¡sicas do discord
intents = message_content = True  # permissÃ£o de leitura de mensagens  
intents.messages = True         # permissÃ£o de resposta de mensagens

bot = commands.Bot(command_prefix="/", intents=intents)

@bot.command(name="promocoes")
async def promocoes(ctx):
    await ctx.send("ðŸ”Ž Buscando promoÃ§Ãµes da Steam...")

    r = requests.get("https://store.steampowered.com/api/featuredcategories/?l=portuguese")
    dados = r.json()["specials"]["items"][:5]

    msg = "**ðŸ”¥ PromoÃ§Ãµes da Steam:**\n"
    for jogo in dados:
        nome = jogo["name"]
        desconto = jogo["discount_percent"]
        imagem = jogo["large_capsule_image"]
        msg += f"ðŸŽ® {nome} â€” **{desconto}% OFF**\n{imagem}\n\n"

    await ctx.send(msg)

@tasks.loop(hours=24) #tempo de repetiÃ§Ã£o de busca de novos jogos em promoÃ§Ã£o
async def buscar_promocoes():
    canal =  bot.get_channel(CANAL_ID)
    r = requests.get("https://store.steampowered.com/api/featuredcategories/?l=portuguese")
    dados = r.json()["specials"]["items"][:5]
    msg = "**ðŸ”¥ PromoÃ§Ãµes da Steam:**\n"
    for jogo in dados:
        msg += f"{jogo['name']} â€” {jogo['discount_percent']}% OFF\n{jogo['large_capsule_image']}\n\n"
    await canal.send(msg)

@bot.event
async def on_ready():
    buscar_promocoes.start()
    print(f"Bot {bot.user} iniciado.")

bot.run(TOKEN)
